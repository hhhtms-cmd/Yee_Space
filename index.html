async function runChat(text) {
    const replyBox = document.getElementById('ai-reply');
    // 1. 确保没有空格：使用 .trim() 强行去掉 Key 前后的隐形字符
    const CLEAN_KEY = "YOUR_NEW_KEY".trim(); 
    
    // 2. 构造标准的 v1beta 路径
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${CLEAN_KEY}`;

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: text }] }]
            })
        });

        const data = await response.json();

        if (response.ok) {
            const reply = data.candidates[0].content.parts[0].text;
            replyBox.innerText = reply;
        } else {
            // 如果报错，直接把错误通过弹窗显示出来，方便我们抓现行
            alert("API 依然报错: " + data.error.message);
            console.error(data.error);
        }
    } catch (err) {
        replyBox.innerText = "网络连接异常。";
    }
}
