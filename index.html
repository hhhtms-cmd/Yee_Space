async function runChat(text) {
    const replyBox = document.getElementById('ai-reply');
    replyBox.innerText = "信号探测中...";

    // 【关键】直接把完整的、带 Key 的 URL 写死，不使用变量，不使用拼接
    const url = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyDk8ZrNTwryMCp1IWIZ8ufwYqgiA00JHjw";

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: text }] }]
            })
        });

        const data = await response.json();

        if (response.ok) {
            replyBox.innerText = data.candidates[0].content.parts[0].text;
        } else {
            // 弹出最原始的错误，不加任何修饰
            console.error("DEBUG RAW ERROR:", data);
            alert("错误详情: " + JSON.stringify(data.error));
        }
    } catch (err) {
        alert("网络层错误: " + err.message);
    }
}
